# 2.1 UserDaoTest 다시 보기(p. 146 ~ 153)

## 2.1.1 테스트의 유용성

- 1장 UserDaoTest 테스트 코드는 main() 메소드를 이용해 UserDao 오브젝트의 add(), get() 메소드를 호출하고, 그 결과를 화면에 출력해서 그 값을 눈으로 확인시켜준다.

   - 테스트용 main() 메소드를 반복적으로 실행해가면서 처음 설계한 대로 기능이 동작하는지 매 단계 확인한 덕분에, 다양한 방법으로 초난감 USerDao 코드의 설계와 코드를 개선했고, 스프링을 적용해서 동작하게 만들 수 있었다.

   - 코드의 구조와 설계, 적용한 기술이 변경되더라도 그 기능은 처음 만들었던 초난감 UserDao와 다르 ㄹ바 없이 DB에 사용자 정보를 등록하고, 가져오는 기능을 잘 수행한다는 걸 테스트를 통해 확인할 수 없었다면, 코드를 개선하는 과정 내내 뭔가 꺼림칙하고 불안했을 것이다.

   - UserDao의 클래스를 책임에 따라 이리저리 분리하고, 인터페이스를 도입하고, 오브젝트 팩토리를 통해 생성하도록 만들고, 또 스프링의 DI 방식을 XML 설정파일까지 써서 적용했을 때 그것이 처음과 동일한 기능을 수행함을 보장해줄 수 있는 방법은 테스트를 통해 직접 기능을 동작시켜서 결과를 확인하는 방법 외에는 없다. 

> 테스트란 내가 예상하고 의도했던 대로 코드가 정확히 동작하는지를 확인해서, 만든 코드를 확신할 수 있게 해주는 작업이다. 테스트의 결과가 원하는 대로 나오지 않는 경우에는 코드나 설계에 결함이 있음을 알 수 있다. 이를 통해 원하는 대로 나오지 않는 제거해가는 작업, 일명 디버깅을 거치게 되고, 최종적으로 테스트가 성공하면 모든 결함이 제거됐다는 확신을 얻을 수 있다.


<br />
<hr />
<br />

## 2.1.2 UserDaoTest의 특징

리스트 2-1. main()메소드로 작성된 테스트
```Java
public class UserDaoTest {
    public static void main(String[] args) throws ClassNotFoundException, SQLException {
        AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(DaoFactory.class);
        UserDao dao = context.getBean("userDao", UserDao.class);

        User user = new User();
        user.setId("whiteShip");
        user.setName("백기선");
        user.setPassword("1234");

        dao.add(user);

        System.out.println(user.getId() + "등록 성공");

        User user2 = dao.get(user.getId());
        System.out.println(user2.getName());
        System.out.println(user2.getPassword());

        System.out.println(user2.getId() + "조회 성공");
    }
}
```

- 테스트 코드의 내용
  
  - 자바에서 가장 손쉽게 실행 가능한 main() 메소드를 이용
  
  - 테스트할 대상인 UserDao의 오브젝트를 가져와 메소드 호출

  - 테스트에 사용할 입력 값을 직접 코드에서 만들어 넣어준다.

  - 테스트의 결과를 콘솔에 출력
  
  - 각 단계의 작업이 에러 없이 끝나면 콘솔에 성공 메시지 출력

- 테스트 방법에서 가장 돋보이는 것은 main 메소드를 이용해 쉽게 테스트 수행을 가능하게 했다는 점과 테스트할 대상이 UserDao를 직접 호출해서 사용했다는 점이다.

<br />

### 웹을 통한 DAO 테스트 방법의 문제점

   - 일반적인 테스트 방법
       
       1. DAO를 만든 뒤 바로 테스트하지 않고, 서비스 계층, MVC 프레젠테이션 게층까지 포함한 모든 입출력 기능을 코드로 구현
       
       2. 만들어진 테스트용 웹 애플리케이션을  서버에 배치한 뒤, 웹 화면을 띄워 값을 입력한 뒤 버튼을 눌러 등록하고 폼의 값을 받아서 파싱한 뒤에 User 오브젝트를 만들고 UserDao를 호출해주는 기능이 이미 만들어져 있어야 한다.
       
       3. 에러가 없으면 검색 폼이나 파라미터를 지정할 수 있는 URL을 사용해서 방금 입력한 데이터를 다시 가져올 수 있는지 테스트를 한다. 
       
       4. UserDao가 돌려주는 결과를 화면에 출력해주는 기능이 만들어져 있어야 확인이 가능하다.

  - 웹 화면을 통해 값을 입력하고, 기능을 수행하고, 결과를 확인하는 방법은 가장 흔히 쓰이는 방법이지만, DAO에 대한 테스트로서는 단점이 너무 많다. 

  - 단점 
    
    1. DAO뿐만 아니라 서비스 클래스, 컨트롤러, JSP 뷰 등 모두 레어어의 기능을 다 만들고 나서야 테스트가 가능하다
    
    2. 테스트를 하는 중에 에러가 나거나 테스트가 실패했을 때 어디에서 문제가 발생했는지 찾아내야 하는 수고도 필요하다. 
    
    3. 하나의 테스트를 수행하는 데 참여하는 클래스와 코드가 너무 많다.

    4. 폼을 띄우고 값을 입력하고 등록 버튼을 눌렀는데 에러 메시지가 떳을 때 에러 메시지와 호출 스택 정보로 원인을 찾을 수 있지만, 아닌 경우가 더 많다.

    5. 등록이 실패하는 원인은 DB 연결 방법에 문제가 있어서일 수 있고, DAO 코드가 잘못되어 JDBC API를 잘못 호출해서일 수 있다. 정작 테스트 대상인 DAO의 문제가 아니라 서버환경에서 웹 화면을 통해 DAO를 테스트하려고 만든 다른 코드 때문에 에러가 나거나 테스트가 실패할 수 있다.

    6. 웹 계층에서 DAO를 바르게 호출하지 못했을 수도 있고, 폼에서 넘어온 파라미터 값을 User 오브젝트에 파싱해서 넣는 데 문제가 있었을 수 도 있다. MVC 컨트롤러의 설정에 문제가 있어서 정상적으로 원하는 컨트롤러가 실행되지 않았을 수 있다. 

    7. 모든 것이 다 성공했지만 최종적으로 결과 메시지를 출력하는 JSP 뷰에 문제가 있어서 오류가 난 것처럼 보일 수 있다.

  - 테스트 대상은 UserDao이지만 다른 계층의 코드와 컴포넌트, 심지어 서버의 설정 상태까지 모두 테스트에 영향을 줄 수 있기 때문에 이런 방식으로 테스트하는 것은 번거롭고, 오류가 있을 때 빠르고 정확하게 대응하기가 힘들다는 문제가 있다.

  - 테스트를 어떻게 만들면 이런 문제를 피할 수 있고, 효율적으로 활용할 수있을 지 생각해야한다.

<br />
<hr />
<br />

### 작은 단위의 테스트

- 테스트는 가능하면 작은 단위로 쪼개서 집중해서 할 수 있어야 한다.

- 테스트의 관심이 다르다면 테스트할 대상을 분리하고 집중해서 접근해야 한다.

<br />
<hr />
<br />

- 단위 테스트
  
  - 작은 단위의 코드에 대해 테스트를 수행한 것을 의미
  
  - 단위는 크기와 범위가 어느 정도인지 딱 정해진 것은 아니다. 
  
  - 크게는 사용자 관리 기능을 통틀어서 하나의 단위로 볼 수 있고, 작게 보자면 UserDao의 add 메소드 하나만 가지고 하나의 단위라 생각할 수 있다.

  - 충분히 하나의 관심에 집중해서 효율적으로 테스트할 만한 범위의 단위라고 보면된다.

  - 일반적으로 단위는 작을수록 좋다. 단위를 넘어서는 다른 코드들은 신경 쓰지 않고, 참여하지도 않고 테스트가 동작할 수 있으면 좋다.

  - 예시로  UserDao는 서비스, MVC 계층이 참여하고 웹 화면과 서버까지 동원하지 않고도 테스트가 가능했다. DAO라는 기능과 DB까지로 단위를 잡고 집중해서 테스트할 수 있었기 때문에 UserDaoTest를 단위 테스트라고 부를 수 있다.

  - DB의 상태가 매번 달라지고, 테스트를 위해 DB를 특정 상태로 만들어줄 수 없다면 UserDaoTest가 단위 테스트로서 가치가 없어진다. 즉, 통제할 수 없는 외부의 리소스에 의존하는 테스트는 단위 테스트가 아니라고 볼 수 있다.

- 웹 사용자 인터페이스부터 시작해서 DB에 이르기까지의 애플리케이션 전 계층이 참여하고, 다른 사용자 등록 작업 하나가 아니라, 초기 등록에서부터 시작해서 등록이 성공하면 로그인하고, 각종 기능을 모두 사용한 다음 로그아웃까지 하는 전 과정을 하나로 묶어서 테스트할 필요가 있다. 각 단위 기능은 잘 동작하는데 묶어놓으면 안되는 경우가 종종 발생하기 때문이다. 

   - 단위 테스트 없이 바로 긴 테스트만 하는 경우도 있다. 아마도 수많은 에러를 만나거나 에러는 안나지만 제대로 기능이 동작하지 않는 경험을 하게 될 것이다. 이때는 문제의 원인을 찾기가 매우 힘들다.

  - 단위 테스트를 하는 이유는 개발자가 설계하고 만든 코드가 원래 의도한 대로 동작하는지를 개발자 스스로 빨리 확인받기 위해서다. 확인의 대상과 조건이 간단하고 명확할수록 좋다.


- 단위 테스트는 주로 개발자가 만든 코드를 스스로 확인하기 위해 사용하고 이를 개발자 테스트 또는 프로그래머 테스트라고 한다.

- UserTest는 UserDao라는 작은 단위의 데이터 액세스 기능만을 테스트하기 위해 만들어졌고, 그 외에 계층이 참여하지 않기 때문에 이는 분명 단위 테스트다. 

- 개선한 코드가 처음 설계하고 의도한 대로 바르게 동작했는지를 확인하기 위해 개발자 입장에서 만든 것이므로 이를 개발자 테스트라고 부를 수도 있다.

<br />
<hr />
<br />

### 자동수행 테스트 코드

- UserDaoTest의 한 가지 특징은 테스트할 데이터가 코드를 통해 제공되고, 테스트 작업은 코드를 통해 자동으로 실행한다.

- 자동으로 수행되는 테스트의 장점은 반복할 수 있다는 점이다.

   - 번거로운 작업이 없고 테스트를 빠르게 실행할 수 있기 때문에 언제든 코드를 수정하고 나서 테스트를 해볼 수 있다.

<br />
<hr />
<br />

### 지속적인 개선과 점진적인 개발을 위한 테스트

  - 스프링을 이용하나 깔끔하고 완성도 높은 객체지향적 코드로 발전시키는 과정의 핵심은 테스트다.

    - 테스트가 없었다면 다양한 방법을 동원해서 코드를 수정하고 설계를 개선하는 과정에 확신할 수 없다.

    - 모든 코드를 다 만들고 난 뒤에 이를 검증하려고 한다면 쏟아지는 에러 메시지에 무엇을 해야할지 몰라 막막해질지 모른다.

<br />
<hr />
<br />

## 2.1.3 UserDaoTest의 문제점

  - 수동 확인 작업의 번거로움

     - 테스트를 수행하는 과정과 입력 데이터의 준비를 모두 자동으로 진행하도록 만들어졌지만 여전히 사람의 눈으로 확인하는 과정이 필요하다.

     - 예를 들면 add메소드에서 User 정보를 등록하고, get메소드를 이용해 가져왔을 때 입력한 값과 가져온 값이 일치하는지를 테스트 코드는 확인해주지 않는다. 단지 콘솔에 값만 출력해줄 뿐이다.

     - 테스트 수행은 코드에 의해 자동으로 진행되긴 하지만 테스트의 결과를 확인하는 일은 사람의 책임이므로 완전히 자동으로 테스트되는 방법은 아니다.
    
    <br />

  - 실행 작업의 번거로움

     - 간단히 실행 가능한 main 메소드라고 하더라도 매번 그것을 실행하는 것은 번거로운 일이다.

     - 예를 들면 DAO가 수백 개가 되고 그에 대한 main 메소드도 그만큼 만들어진다면, 전체 기능을 테스트해보기 위해 main 메소드를 수백 번 실행해야하고 그 결과를 눈으로 확인해서 기록하고 이를 종합해서 전체 기능을 모두 테스트한 결과를 정리하려면 제법 큰 작업이 된다.

     - main 메소드를 이용하는 방법보다 편리하고 체계적으로 테스트를 실행하고 결과를 확인하는 방법이 절실히 필요하다.

  
   