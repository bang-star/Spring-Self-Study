# 1.4 제어의 역전(IoC) (p.88 ~ 91)

## 1.4.3 제어권의 이전을 통한 제어관계 역전

<br />

> 제어의 역전은 간단히 프로그램의 제어 흐름 구조가 뒤바뀐 것을 의미한다.

<br />

1. 일반적인 프로그램의 흐름
    
    1. main()메소드와 같이 프로그램이 시작되는 지점에서 사용할 오브젝트 결정

    2. 결정한 오브젝트를 생성하고, 만들어진 오브젝트에 있는 메소드 호출

    3. 해당 오브젝트 메소드 안에서 사용할 것을 결정하고 호출하는 식의 작업 반복

- 일반적인 프로그램의 흐름 구조에서 각 오브젝트는 프로그램 흐름을 결정하거나 사용할 오브젝트를 구성하는 작업에 능동적으로 참여한다.

- 모든 오브젝트가 능동적으로 자신이 사용할 클래스를 결정하고, 언제 어떻게 그 오브젝트를 만들지를 스스로 관장한다. 모든 종류의 작업을 사용하는 쪽에서 제어하는 구조다.

<br />

- 제어의 역전

    - 오브젝트가 자신이 사용할 오브젝트를 스스로 선택과 생성을 하지 않는다. 자신이 어떻게 만들어지고 어디서 사용되는지를 알 수 없다.
    
    - 모든 제어 권한을 자신이 아닌 다른 대상에게 위임하기 때문이다.

    - 프로그램의 시작을 담당하는 main과 같은 엔트리 포인트를 제외하면 모든 오브젝트는 이렇게 위임받은 제어 권한을 갖는 특별한 오브젝트에 의해 결정되고 만들어진다.
<br />

```
* 제어의 역전 개념이 적용된 예

초난감 DAO 개선 작업의 초기에 적용햇던 템플릿 메소드 패턴에 추상 UserDao를 상속한 서브클래스는 getConnection()을 구현한다. 하지만 이 메소드가 언제 어떻게 사용될지 자신은 모른다. 서브클래스에서 결정되는 것이 아니고 단지 이런 방식으로 DB 커넥션을 만든다는 기능만 구현해놓으면, 슈퍼클래스인 UserDao의 템플릿 메소드인 add(), get() 등에서 필요할 때 호출해서 사용하는 것이다. 즉 제어권을 상위 템플릿 메소드에 넘기고 자신은 필요할 때 호출되어 사용되도록 한다는, 제어의 역전 개념을 발견할 수 있다. 

템플릿 메소드는 제어의 역전이라는 개념을 활용해 문제를 해결하는 디자인 패턴이라고 볼 수 있다.
```

### 프레임워크 

- 프레임워크는 제어의 역전 개념이 적용된 대표적인 기술이며, 라이브러리의 다른 이름이 아니다.

- 프레임워크는 미리 만들어둔 반제품이나, 확장해서 사용할 수 있도록 준비된 추상 라이브러리의 집합이 아니다.

- 라이브러리를 사용하는 애플리케이션 코드는 애플리케이션 흐름을 직접 제어한다. 단지 동작하는 중에 필요한 기능이 있을 때 능동적으로 라이브러리를 사용할 뿐이다.

- 프레임워크는 애플리케이션 코드가 프레임워크에 의해 사용된다. 개발한 클래스를 프레임워크 위에 등록하면 프레임워크가 흐름을 주도하여 애플리케이션 코드를 사용하도록 만드는 방식이다.

- 최근에 툴킷, 엔진, 라이브러리 등도 유행을 따라서 무작정 프레임워크라 부르기도 하는데 잘못된 표현이다.

- 프레임워크에는 분명한 제어의 역전 개념이 적용되어 있어야 한다. 애플리케이션 코드는 프레임워크가 짜놓은 틀에서 수동적으로 동작해야 한다.

```
(예시)
UserDao와 DaoFactory에 제어의 역전이 적용되어 있다. ConnectionMaker의 구현 클래스를 결정하고 오브젝트를 만드는 제어권은 UserDao에서 DaoFactory으로 옮겼다. 자신이 어떤 ConnectionMaker 구현 클래스를 만들고 사용할지를 결정한 권한을 DaoFactory에 전달하여 UserDao는 수동적인 존재가 되었다. UserDao 자신도 팩토리에 의해 수동적으로 만들어지고 자신이 사용할 오브젝트도 DaoFactory가 공급해주는 것을 수동적으로 사용해야 할 입장이 됐다. 

UserDaoTest는 DaoFactory가 만들고 초기화해서 자신에게 사용하도록 공급해주는 ConnectionMaker를 사용할 수 밖에 없다. UserDao와 ConnectionMaker의 구현체를 생성하는 책임도 DaoFactory가 맡고 있다. 바로 이것이 제어의 역전이 일어난 상황이다.

자연스럽게 관심을 분리하고 책임을 나누고 유연하게 확장 가능한 구조로 만들기 위해 DaoFactory를 도입했던 과정이 바로 IoC(제어의 역전) 스타일의 설계의 코드를 만들어 사용하면 된다.
```

- 제어의 역전에서는 프레임워크 또는 컨테이너와 같이 애플리케이션 컴포넌트의 생성과 관계설정, 사용, 생성주기 관리 등을 관장하는 존재가 필요하다.

- DaoFactory는 오브젝트 수준의 가장 단순한 IoC 컨테이너 내지는 IoC 프레임워크라 불릴 수 있다.

- 단순한 적용이라면 DaoFactory와 같이 IoC 제어권을 가진 오브젝트를 분리해서 만드는 방법이면 충분하겠지만, IoC를 애플리케이션 전반에 걸쳐 본격적으로 적용하려면 스프링과 같은 IoC 프레임워크의 도움을 받는 편이 훨씬 유리하다.

- 스프링은 IoC를 모든 기능의 기초가 되는 기반기술로 삼고 있으며, IoC를 극한까지 적용하고 있는 프레임워크이다.